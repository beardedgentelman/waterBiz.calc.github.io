<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
    <link href="nouislider.css" rel="stylesheet" />
    <script src="nouislider.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Water Biz</title>
    <style>
      /* Chrome, Safari, Edge, Opera */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Firefox */
      input[type="number"] {
        -moz-appearance: textfield;
      }
      body {
        font-family: "Poppins", sans-serif;
        color: #272727;
      }
      .noUi-value,
      .noUi-tooltip {
        font-size: 10px;
      }
      .noUi-vertical .noUi-handle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        right: -9px;
      }
      .noUi-vertical .noUi-handle:before,
      .noUi-vertical .noUi-handle:after {
        display: none;
      }
      .noUi-pips-vertical {
        top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="mx-auto h-[100svh] h-screen max-w-2xl overflow-hidden relative">
      <header class="w-full px-3 pt-3 pb-4 bg-[#d5dedd] flex items-center justify-between">
        <a href="#" class="w-10 flex items-baseline">
          <img class="w-full" src="logo_clear.png" alt="logo" />
          <span class="text-5xl font-bold text-gray-600 ml-2">WaterBiz</span>
        </a>
        <a href="#" class="py-2 px-3" id="open_info_popup">
          <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 512 512" style="enable-background: new 0 0 512 512" xml:space="preserve">
            <g>
              <path
                d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M256,464
              c-114.875,0-208-93.125-208-208S141.125,48,256,48s208,93.125,208,208S370.875,464,256,464z M224,128h64v64h-64V128z M320,384H192
              v-32h32v-96h-32v-32h96v128h32V384z"
                fill="#7a7a7a"
              />
            </g>
          </svg>
        </a>
      </header>
      <main class="flex flex-col justify-between pb-4" style="height: calc(100svh - 76px)">
        <div class="w-full py-2 px-4 border border-gray-300 flex flex-col justify-between mx-auto text-lg bg-[#d5dedd]">
          <span class="store_chain text-xl uppercase font-bold"></span>
          <span>Автомат №<span class="machine_number"></span></span>
          <span class="address"></span>
          <div class="flex w-full justify-center gap-6">
            <span class="water_name"></span>
            <span><span class="water_price_in"></span> грн./літр</span>
          </div>
        </div>
        <form>
          <div class="py-5 px-4 flex justify-between items-center">
            <div class="flex flex-col items-center gap-[10svh]">
              <div class="flex items-baseline py-[5%] px-4 w-full relative">
                <input id="water_input" type="text" min="0" max="60" step="0.1" inputmode="numeric" class="w-[200px] max-[380px]:w-[160px] outline-none focus:outline-none text-center text-5xl max-[380px]:text-3xl font-bold text-md border-b border-gray-400 focus:text-black flex items-center" name="water_input" placeholder="00.00" /><span class="ml-2">літр.</span>
                <div id="water_error" class="absolute -top-[20px] left-0 -translate-x-5 w-full text-xl items-center justify-center rounded-lg bg-red-700" style="display: none">
                  <span class="text-white">Максимум 60 літр.</span>
                </div>
              </div>
              <div class="flex items-baseline py-[5%] px-4 w-full relative">
                <input id="water_input_price" type="text" min="0" max="60" step="0.1" inputmode="numeric" class="w-[200px] max-[380px]:w-[180px] outline-none focus:outline-none text-center text-5xl max-[380px]:text-3xl font-bold text-md border-b border-gray-400 focus:text-black flex items-center" name="water_input_price" placeholder="00.00" /><span class="ml-2">грн.</span>
                <div id="water_price_error" class="absolute -top-[20px] left-0 -translate-x-5 w-full text-xl items-center justify-center rounded-lg bg-red-700" style="display: none">
                  <span class="text-white">Максимум 60 грн.</span>
                </div>
              </div>
            </div>
            <div class="flex flex-col w-full pr-2">
              <div id="slider" class="h-60 max-[380px]:h-[200px] w-3 border-none bg-indigo-300 mx-auto my-0"></div>
            </div>
          </div>
          <button type="submit" id="submit" class="block py-2 px-6 mt-16 w-[60%] mx-auto text-center bg-indigo-400 active:bg-indigo-700 text-xl font-bold text-white rounded-lg">Сплатити</button>
        </form>
      </main>
      <div id="info_popup" class="absolute top-0 left-0 rounded-lg bg-white text-center pt-10 pb-2 px-6 w-full h-screen h-[100svh] z-10" style="display: none">
        <div id="close_info_popup" class="absolute top-1 right-2 text-2xl font-bold">X</div>
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ex ab rerum veritatis, quo earum voluptates aliquid adipisci et laborum porro quae tempore! Similique saepe voluptate amet. Laboriosam veniam atque, corrupti quia, adipisci beatae eveniet iure laborum alias quod consequatur, nostrum voluptas non blanditiis libero! Qui autem fugit cumque excepturi esse recusandae modi voluptates sunt architecto maxime! Vitae facilis explicabo placeat unde rerum optio dolorem amet similique minima expedita iste, voluptates aliquam laborum debitis ad! Cupiditate nemo architecto unde animi voluptas nesciunt obcaecati voluptates aspernatur et ducimus modi velit, tenetur repellendus veniam eos accusantium deleniti quidem blanditiis vitae vel molestias corrupti? Ipsam debitis eos fugit expedita omnis, modi laboriosam autem unde aut delectus laudantium fuga! Animi ut fuga, pariatur fugiat, quam nulla omnis expedita voluptas quae voluptates quo aliquam quasi alias incidunt recusandae provident praesentium dolore vero nihil doloribus officiis. Nulla consectetur nostrum, voluptatem quod aperiam totam pariatur iste molestias fugiat!
      </div>
    </div>
  </body>

  <script>
    window.addEventListener("load", () => {
      const storeChain = document.querySelector(".store_chain");
      const machineNumber = document.querySelector(".machine_number");
      const address = document.querySelector(".address");
      const waterName = document.querySelector(".water_name");
      const waterPriceIn = document.querySelector(".water_price_in");
      const waterPrice = 0.5;
      const regex = /^\d*\.?\d{0,2}$/;

      const waterInput = document.getElementById("water_input");
      const waterInputPrice = document.getElementById("water_input_price");
      const waterError = document.getElementById("water_error");
      const waterPriceError = document.getElementById("water_price_error");
      const max = 60;

      const submitBtn = document.getElementById("submit");

      const openInfo = document.getElementById("open_info_popup");
      const infoPopup = document.getElementById("info_popup");
      const closeInfoPopup = document.getElementById("close_info_popup");

      var rangeInput = document.getElementById("slider");

      noUiSlider.create(rangeInput, {
        range: {
          min: [0, 0.1],
          "33.3%": [3, 0.5],
          "66.6%": [20, 1],
          max: [60],
        },
        step: 1,
        start: [0],
        margin: 300,
        connect: true,
        direction: "rtl",
        orientation: "vertical",
        behaviour: "tap-drag",
        tooltips: true,
        pips: {
          mode: "range",
          stepped: true,
          density: 1,
        },
      });

      rangeInput.noUiSlider.on("slide", () => {
        waterInput.value = rangeInput.noUiSlider.get();
        waterInputPrice.value = waterInput.value * waterPrice;
      });

      waterInput.addEventListener("input", function () {
        let value = this.value.replace(/[^\d.]/g, "");
        if (!regex.test(value)) {
          this.value = "";
          return;
        }
        value = parseFloat(value);
        if (isNaN(value)) {
          this.value = "";
        } else if (value > max) {
          this.value = "";
          waterInputPrice.value = "";
          waterError.style.display = "flex";
          rangeInput.noUiSlider.set(0);
        }
        if (this.value === "") {
          waterInputPrice.value = 0;
          rangeInput.noUiSlider.set(0);
        } else {
          waterInputPrice.value = (value * waterPrice).toFixed(2);
          rangeInput.noUiSlider.set(value);
          waterError.style.display = "none";
          waterPriceError.style.display = "none";
        }
      });

      waterInputPrice.addEventListener("input", function () {
        let value = this.value.replace(/[^\d.]/g, "");
        if (!regex.test(value)) {
          this.value = "";
          return;
        }
        value = parseFloat(value);
        if (isNaN(value)) {
          this.value = "";
        } else if (value > max) {
          this.value = "";
          waterInput.value = "";
          waterPriceError.style.display = "flex";
          rangeInput.noUiSlider.set(0);
        }
        if (this.value === "") {
          waterInput.value = 0;
          rangeInput.noUiSlider.set(0);
        } else {
          waterInput.value = (value / waterPrice).toFixed(2);
          rangeInput.noUiSlider.set(waterInput.value);
          waterPriceError.style.display = "none";
          waterError.style.display = "none";
        }
      });

      function setInfo() {
        storeChain.innerHTML = "Назва мережі";
        machineNumber.innerHTML = "00";
        address.innerHTML = "Адреса";
        waterName.innerHTML = "Вид води";
        waterPriceIn.innerHTML = waterPrice.toString();
      }

      setInfo();

      submitBtn.addEventListener("click", function () {
        console.log(`Water count: ${waterInput.value}, Coast: ${waterInputPrice.value}`);
      });

      openInfo.addEventListener("click", () => {
        if ((infoPopup.style.display = "none")) {
          infoPopup.style.display = "block";
        } else {
          infoPopup.style.display = "none";
        }
      });

      closeInfoPopup.addEventListener("click", () => {
        infoPopup.style.display = "none";
      });
    });
  </script>
</html>
